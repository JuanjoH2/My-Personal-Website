---
import Logo from "../assets/icons/jjhWhite.svg";
import Menu from "./Menu.astro";
import Navigation from "./Navigation.astro";
---

<header class="main-header">
    <a href="/" class="home-link">
        <Logo class="logo" aria-label="Return to homepage" />
    </a>

    <div class="menu">
        <Menu aria-label="Open menu" />
        <Navigation />
    </div>
</header>

<style>
    .main-header {
        /* Pins the header to the top of the viewport */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 64px;
        /* Defines the height of the header (64px) */

        /* Ensure the header is always on top of other content */
        z-index: 100;

        /* Basic styling for visibility */
        background-color: #1e1f20, 0;

        /* Flex alignment for logo placement */
        display: flex;

        /* Vertically center the logo */
        align-items: center;

        justify-content: space-between;
    }

    /* Style for the SVG/Logo element */
    .logo {
        height: 64px;
        width: 64px;
        display: block;
        margin-top: 16px;
        margin-left: 16px;
        cursor:
            url("../assets/circle2.svg") 8 8,
            pointer;
    }

    .menu {
        margin-top: 16px;
        margin-right: 16px;
    }
</style>

<script defer is:inline>
    // 1. Get all necessary DOM elements
    const toggleButton = document.getElementById("menu-toggle"); // The button that opens the menu (hamburger icon)
    const navLinks = document.getElementById("main-menu-links"); // The actual navigation list container
    const closeBtn = document.getElementById("close-button"); // The button inside the menu to close it ('X' icon)
    const backdrop = document.getElementById("backdrop"); // The dark full-page overlay

    /**
     * Toggles the menu state (open/closed) and updates all related elements.
     * @param {boolean} closeOnly - Forces the menu to close.
     */
    const toggleMenu = (closeOnly = false) => {
        // Essential check: If navLinks or backdrop don't exist, exit the function.
        if (!navLinks || !backdrop) return;

        // Determine the new expanded state. If closeOnly is true, force it to false.
        const shouldBeExpanded = closeOnly
            ? false
            : !navLinks.classList.contains("expanded");

        // Apply the 'expanded' class to the navigation
        navLinks.classList.toggle("expanded", shouldBeExpanded);

        // Apply the 'visible' class to the backdrop
        backdrop.classList.toggle("visible", shouldBeExpanded);

        // Update the main toggle button's aria-expanded attribute
        if (toggleButton) {
            toggleButton.setAttribute(
                "aria-expanded",
                String(shouldBeExpanded),
            );
        }
    };

    // Check if the essential elements are present before adding listeners
    if (navLinks && backdrop) {
        // A. Open/Close Menu using the Main Hamburger Button
        if (toggleButton) {
            toggleButton.addEventListener("click", () => toggleMenu());
        }

        // B. Close Menu using the 'X' Button inside the menu
        if (closeBtn) {
            // Force the menu to close when 'X' is clicked
            closeBtn.addEventListener("click", () => toggleMenu(true));
        }

        // C. Auto-Close Menu when a Navigation Link is Clicked
        // Check navLinks again before trying to query its children
        navLinks.querySelectorAll("a").forEach((link) => {
            // Force the menu to close when a link is clicked
            link.addEventListener("click", () => toggleMenu(true));
        });

        // D. Close Menu when the Backdrop is Clicked (Recommended UX)
        backdrop.addEventListener("click", () => toggleMenu(true));
    }
</script>
